{% extends "base.html" %}
{% block content %}
<h1>Microsub Dashboard</h1>
{% with messages = get_flashed_messages() %}
{% if messages %}
<section class="notification">
  <p class="error">{{ messages[0] }}</p>
</section>
{% endif %}
{% endwith %}
<section class="content_box">
    <h2>Channels</h2>
    {% if channels %}
      <p>Here are the channels in your feed:</p>
      <ul>
      {% for i in range(0, channels | length) %}
      <li class="button_list">
        <a href="/channel/{{ channels[i][1] }}">{{ channels[i][0] }}</a>
        <div style="float: right; position: relative;">
        {% if i != 0 %}
        <form action="/reorder" method="POST"><input type="hidden" name="channel" value="{{ channels[i][1] }}"><input type="hidden" name="channel" value="{{ channels[i-1][1] }}"><input type="submit" value="Move Up"></form>
        {% endif %}
        {% if i < channels | length - 1 %}
        <form action="/reorder" method="POST"><input type="hidden" name="channel" value="{{ channels[i][1] }}"><input type="hidden" name="channel" value="{{ channels[i+1][1] }}"><input type="submit" value="Move Down"></form>
        {% endif %}
        </div>
      </li>
      {% endfor %}
      </ul>
    {% else %}
      <p>You have not created any channels yet.</p>
    {% endif %}
</section>
<section class="content_box">
    <h2>Create a Channel</h2>
    <p>Use the form below to create a channel.</p>
    <form action="/create-channel" method="POST">
      <label for="name">Channel Name:</label><br>
      <input type="text" name="name" id="name" placeholder="IndieWeb" required><br>
      <input type="submit" value="Create channel" />
      <input type="hidden" name="action" id="action" value="channels" />
    </form>
</section>
<section class="content_box">
  <h2>Discover a Feed</h2>
  <p>Use the form below to discover a feed URL.</p>
  <p>Microformats 2 (mf2) and RSS feeds are currently supported.</p>
  <form action="/discover" method="POST">
    <label for="discover">Website Address:</label><br>
    <input id="discover" type="url" name="url" placeholder="https://theguardian.com" /><br>
    <input type="submit" value="Discover feed" />
  </form>
</section>
<section class="content_box">
    <h2>Subscribe to a Feed</h2>
    <p>Use the form below to subscribe to a feed.</p>
    <p>Microformats 2 (mf2) and RSS feeds are currently supported.</p>
    <form action="/feeds" method="POST">
      <label for="channel">Channel Name:</label><br>
      <select name="channel" id="channel">
        {% for channel in channels %}
          <option value="{{ channel[1] }}">{{ channel[0] }}</option>
        {% endfor %}
      </select><br>
      <label for="url">Feed Address:</label><br>
      <input id="url" type="url" name="url" placeholder="https://jamesg.blog/feed.xml" /><br>
      <input type="submit" value="Subscribe" />
      <input type="hidden" name="action" id="action" value="follow" />
    </form>
</section>
{% endblock %}